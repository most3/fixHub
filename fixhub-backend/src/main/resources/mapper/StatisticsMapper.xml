<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fixhub.statistics.mapper.StatisticsMapper">

    <select id="selectDashboardStats" resultType="com.fixhub.statistics.dto.DashboardStats">
        SELECT
            COUNT(*) AS totalOrders,
            COALESCE(SUM(CASE WHEN status = 'PENDING' THEN 1 ELSE 0 END), 0) AS pendingOrders,
            COALESCE(SUM(CASE WHEN status = 'CLOSED' THEN 1 ELSE 0 END), 0) AS completedOrders,
            COALESCE((SELECT AVG(rating) FROM comments), 0) AS averageRating
        FROM repair_orders
    </select>

</mapper>
